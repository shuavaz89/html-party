let PARTY_ELEMENTS=[{element:"select",nodeName:"SELECT"},{element:"textarea",nodeName:"TEXTAREA"},{element:"input",nodeName:"INPUT"},{element:"svg",nodeName:"SVG"},{element:"img",nodeName:"IMG"},{element:"button",nodeName:"BUTTON"},{element:"a",nodeName:"A"},{element:"p",nodeName:"P"},{element:"span",nodeName:"SPAN"},{element:"h1",nodeName:"H1"},{element:"h2",nodeName:"H2"},{element:"h3",nodeName:"H3"},{element:"h4",nodeName:"H4"},{element:"h5",nodeName:"H5"},{element:"h6",nodeName:"H6"},{element:"caption",nodeName:"CAPTION"},{element:"td",nodeName:"TD"}],FUN_COLORS=["#ec1254","#f27c14","#f5e31d","#1ee8b6","#26a1d5","#570bb7","#d042f8","#2edbef","#3aefb6","#f10983","#d61173","#fb5cab","#52c1fa","#178bd5","#f5ed16"],COLOR_FREQ=["#1e8967","#ffd702","#f48d3f","#d02f4e"],PARTY_TEXT_CLASSES=["party-time-color","party-time-textShadow","party-time-colorVolume","party-time-fontSize"],PARTY_CONTAINER_CLASSES=["party-time-boxShadow","party-time-bkgColor","party-time-height","party-time-width","party-time-posTop","party-time-posRight","party-time-posBottom","party-time-posLeft"],PARTY_TIME_CLASSES=["party-time-color","party-time-textShadow","party-time-boxShadow","party-time-bkgColor","party-time-height","party-time-width","party-time-colorVolume","party-time-fontSize","party-time-posTop","party-time-posRight","party-time-posBottom","party-time-posLeft"],PARTY_TIME_FREQ_CLASSES=["","party-time-freq-low","party-time-freq-mid","party-time-freq-high"],PARTY_TIME_FREQ_SCALE_CLASSES=["","party-time-freq-scale-10","party-time-freq-scale-20","party-time-freq-scale-30","party-time-freq-scale-40","party-time-freq-scale-50","party-time-freq-scale-60","party-time-freq-scale-70","party-time-freq-scale-80","party-time-freq-scale-90","party-time-freq-scale-100"];function removeArrayItem(t,e){e=t.indexOf(e);-1!==e&&t.splice(e,1)}function cloneArray(t){return JSON.parse(JSON.stringify(t))}function getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function objToStyles(t,e){for(var a in e)t.style.setProperty(a,e[a],"important")}function middleValue(t,e){return Math.round((t+e)/2)}function generateUI(){var t=document.createElement("div"),e=(t.id="party-time-container",t.classList="party-time-controls",t.style.setProperty("z-index","999999","important"),t.style.setProperty("display","flex","important"),t.style.setProperty("flex-direction","column","important"),t.style.setProperty("color","white","important"),t.style.setProperty("font-size","12px","important"),t.style.setProperty("position","fixed","important"),t.style.setProperty("top","16px","important"),t.style.setProperty("right","16px","important"),t.style.setProperty("background-color","rgba(0,0,0,0.24)","important"),t.style.setProperty("padding","8px","important"),t.style.setProperty("border-radius","8px","important"),document.createElement("div")),a=(e.classList.add("party-time-controls"),document.createElement("button")),a=(a.id="party-time-button",a.classList.add("party-time-controls"),a.innerText="ðŸŽ‰ Party Time!",a.onclick=startParty,objToStyles(a,{"margin-right":"8px",color:"white",cursor:"pointer","background-color":"purple",padding:"8px",border:"1px solid violet","border-radius":"8px","font-size":"12px"}),e.appendChild(a),document.createElement("input")),a=(a.setAttribute("type","file"),a.id="party-upload",a.classList.add("party-time-controls"),a.onchange=handleAudioFile,objToStyles(a,{width:"150px","margin-right":"8px","font-size":"12px"}),e.appendChild(a),document.createElement("button")),a=(a.id="party-time-collapse-btn",a.classList.add("party-time-controls"),a.innerText="v",a.onclick=togglePartyTimeOptions,objToStyles(a,{background:"rgba(0, 0, 0, 0.87)",cursor:"pointer",border:"0","border-radius":"24px",padding:"5px 10px","font-weight":"bold","font-size":"18px",transform:"rotate(0deg)",color:"white"}),e.appendChild(a),document.createElement("div")),r=(a.id="party-time-collapsible",a.classList.add("party-time-controls"),a.style.setProperty("display","none","important"),a.style.setProperty("padding","8px","important"),document.createElement("label")),r=(r.setAttribute("for","party-auto-party"),r.classList.add("party-time-controls"),r.innerText="Auto Party",objToStyles(r,{"font-weight":"bold",color:"white","font-size":"12px"}),a.appendChild(r),document.createElement("input")),r=(r.setAttribute("type","checkbox"),r.id="party-auto-party",r.classList.add("party-time-controls"),r.onchange=handleAutoParty,a.appendChild(r),document.createElement("label")),r=(r.setAttribute("for","party-debug"),r.classList.add("party-time-controls"),r.innerText="Show Freq",objToStyles(r,{"font-weight":"bold",color:"white","font-size":"12px"}),a.appendChild(r),document.createElement("input"));r.setAttribute("type","checkbox"),r.id="party-debug",r.classList.add("party-time-controls"),r.onchange=handleDebug,a.appendChild(r),t.appendChild(e),t.appendChild(a),document.body.appendChild(t)}function addPartyClasses(t,e){var e=cloneArray(e),a=e[getRandomInt(0,e.length-1)],e=(t.classList.add(a),removeArrayItem(e,a),a=e[getRandomInt(0,e.length-1)],t.classList.add(a),PARTY_TIME_FREQ_SCALE_CLASSES[getRandomInt(0,PARTY_TIME_FREQ_SCALE_CLASSES.length-1)]);e&&t.classList.add(e)}function setupPartyClasses(t){switch(t.nodeName){case"SELECT":case"TEXTAREA":case"INPUT":addPartyClasses(t,PARTY_TIME_CLASSES);break;case"SVG":case"IMG":addPartyClasses(t,PARTY_CONTAINER_CLASSES);break;case"BUTTON":addPartyClasses(t,PARTY_TIME_CLASSES);break;case"A":case"P":case"SPAN":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"CAPTION":addPartyClasses(t,PARTY_TEXT_CLASSES);break;default:addPartyClasses(t,PARTY_TIME_CLASSES)}}function containsPartyTimeClasses(t){let e=!1;for(var a=0;a<PARTY_TIME_CLASSES.length;a++)t.classList.contains(PARTY_TIME_CLASSES[a])&&(e=!0);return e}function removePartyTimeClasses(t){for(var e=0;e<PARTY_TIME_CLASSES.length;e++)PARTY_TIME_CLASSES[e]&&t.classList.contains(PARTY_TIME_CLASSES[e])&&t.classList.remove(PARTY_TIME_CLASSES[e]);for(var a=0;a<PARTY_TIME_FREQ_CLASSES.length;a++)PARTY_TIME_FREQ_CLASSES[a]&&t.classList.contains(PARTY_TIME_FREQ_CLASSES[a])&&t.classList.remove(PARTY_TIME_FREQ_CLASSES[a])}var _cacheIndex=[],_cacheWidth=[],_cacheHeight=[],_cache=[],_cache2=[],_cache3=[],_cache4=[];let auto_party=!1,debug_mode=!1,is_playing=!1,clear_styles=!1,audioSource=null,analyser=null,animate,audio1;var initSetup=function(){generateUI()},handleAudioFile=function(t){t=t.target.files,(audio1=new Audio).src=URL.createObjectURL(t[0]),audio1.loop=!0,t=new(window.AudioContext||window.webkitAudioContext);audioSource=t.createMediaElementSource(audio1),analyser=t.createAnalyser(),audioSource.connect(analyser),analyser.connect(t.destination),analyser.fftSize=128},partyTimeCollapseState=!0,togglePartyTimeOptions=function(){var t=document.getElementById("party-time-collapsible"),e=document.getElementById("party-time-collapse-btn");partyTimeCollapseState?(partyTimeCollapseState=!1,e.style.setProperty("transform","rotate(180deg)","important"),t.style.setProperty("display","block","important")):(partyTimeCollapseState=!0,e.style.setProperty("transform","rotate(0deg)","important"),t.style.setProperty("display","none","important"))},handleAutoParty=function(t){auto_party=t.target.checked},handleDebug=function(t){debug_mode=t.target.checked},startParty=function(){var a=document.getElementById("party-time-button");if(analyser.fftSize=128,console.log(audio1.src),audio1&&audio1.pause(),audio1.src)if(is_playing)audio1.pause(),clearStyles(),is_playing=!1,clear_styles=!0,a.innerText="ðŸŽ‰ Party Time!",cancelAnimationFrame(animate);else{a.innerText="Stop The Party... ðŸ˜”",is_playing=!0,audio1.play();let t=analyser.frequencyBinCount,e=new Uint8Array(t);(animate=function(){clear_styles?clearStyles():(analyser.getByteFrequencyData(e),partyTime(t,e),requestAnimationFrame(animate))})()}},clearStyles=function(){for(var t=document.querySelectorAll('*[class*="party-time"]:not(.party-time-controls)'),e=0,a=t.length;e<a;e++)if(t[e].removeAttribute("style"),t[e].classList.contains("party-time-baby"))for(var r=t[e].querySelectorAll('*[class*="party-time"]:not(.party-time-controls)'),o=0;o<r.length;o++)removePartyTimeClasses(r[o]);for(var n=document.querySelectorAll(".debug-freq"),o=0,a=n.length;o<a;o++)n[o].remove();clear_styles=!1,_cacheIndex=[],_cacheWidth=[],_cacheHeight=[],_cache=[],_cache2=[],_cache3=[],_cache4=[]},applyStyles=function(t){for(var e=0,a=t.length;e<a;e++)t[e].style={}},partyTime=function(e,t){for(var a=[],r=0;r<e;r++)0!==t[r]&&a.push(t[r]);auto_party&&(document.body.classList.contains("party-time-bkgColor")||document.body.classList.add("party-time-bkgColor"),document.body.classList.contains("party-time-baby")||document.body.classList.add("party-time-baby"));var o=document.querySelectorAll('*[class*="party-time"]:not(.party-time-controls)');for(let t=0;t<o.length;t++)if(o[t])if(o[t].classList.contains("party-time-baby")){var n,s=o[t].querySelectorAll("select:not(.debug-freq):not(.party-time-controls),textarea:not(.debug-freq):not(.party-time-controls),input:not(.debug-freq):not(.party-time-controls),svg:not(.debug-freq):not(.party-time-controls),img:not(.debug-freq):not(.party-time-controls),button:not(.debug-freq):not(.party-time-controls),a:not(.debug-freq):not(.party-time-controls),p:not(.debug-freq):not(.party-time-controls),span:not(.debug-freq):not(.party-time-controls),h1:not(.debug-freq):not(.party-time-controls),h2:not(.debug-freq):not(.party-time-controls),h3:not(.debug-freq):not(.party-time-controls),h4:not(.debug-freq):not(.party-time-controls),h5:not(.debug-freq):not(.party-time-controls),h6:not(.debug-freq):not(.party-time-controls),caption:not(.debug-freq):not(.party-time-controls),td:not(.debug-freq):not(.party-time-controls)");for(let t=0;t<s.length;t++)s[t]&&(!containsPartyTimeClasses(s[t])&&(setupPartyClasses(s[t]),n=PARTY_TIME_FREQ_CLASSES[getRandomInt(0,PARTY_TIME_FREQ_CLASSES.length-1)])&&s[t].classList.add(n),vfx(t,s[t],e,a))}else vfx(t,o[t],e,a)},vfx=function(t,e,a,r){_cacheIndex[t]||(_cacheIndex[t]=getRandomInt(0,a-1));let o=r[_cacheIndex[t]]||0!==r[_cacheIndex[t]]?r[_cacheIndex[t]]:r[getRandomInt(0,a-1)];e.classList.contains("party-time-freq-low")&&(o=getFreqRange(r,"low")),e.classList.contains("party-time-freq-mid")&&(o=getFreqRange(r,"mid")),e.classList.contains("party-time-freq-high")&&(o=getFreqRange(r,"high"));var a=getFreqScale(e.classList);e.classList.contains("party-time-color")&&(r=Math.floor(o/a),_cache[t]!==r)&&(_cache[t]=r,e.style.setProperty("color",FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],"important")),e.classList.contains("party-time-textShadow")&&(r=Math.floor(o/a),_cache3[t]!==r)&&(_cache3[t]=r,r=FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],e.style.setProperty("color","#FFFFFF","important"),e.style.setProperty("text-shadow","0 0 "+o/10+"px #fff, 0 0 "+o/9+"px #fff, 0 0 "+o/8+"px "+r+", 0 0 "+o/7+"px "+r+", 0 0 "+o/6+"px "+r+", 0 0 "+o/5+"px "+r+", 0 0 "+o/4+"px "+r,"important")),e.classList.contains("party-time-boxShadow")&&(r=Math.floor(o/a),_cache4[t]!==r)&&(_cache4[t]=r,r=FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],e.style.setProperty("box-shadow","0 0 10px #fff, 0 0 20px #fff, 0 0 30px "+r+", 0 0 40px "+r+", 0 0 50px "+r+", 0 0 60px "+r+", 0 0 70px "+r,"important")),e.classList.contains("party-time-bkgColor")&&(r=Math.floor(o/a),_cache2[t]!==r)&&(_cache2[t]=r,e.style.setProperty("background-color",FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],"important")),e.classList.contains("party-time-colorVolume")&&e.style.setProperty("color",COLOR_FREQ[Math.floor(o/a)],"important"),e.classList.contains("party-time-fontSize")&&(r=o/(a/20),e.style.setProperty("font-size",(r<=0?10:r)+"px","important")),e.classList.contains("party-time-width")&&(_cacheWidth[t]||(_cacheWidth[t]=e.offsetWidth),e.style.setProperty("width",_cacheWidth[t]+o/2+"px","important")),e.classList.contains("party-time-height")&&(_cacheHeight[t]||(_cacheHeight[t]=e.offsetHeight),e.style.setProperty("height",_cacheHeight[t]+o/2+"px","important")),e.classList.contains("party-time-posTop")&&(e.style.setProperty("position","relative","important"),e.style.setProperty("top",o/5+"px","important")),e.classList.contains("party-time-posRight")&&(e.style.setProperty("position","relative","important"),e.style.setProperty("right",o/5+"px","important")),e.classList.contains("party-time-posBottom")&&(e.style.setProperty("position","relative","important"),e.style.setProperty("bottom",o/5+"px","important")),e.classList.contains("party-time-posLeft")&&(e.style.setProperty("position","relative","important"),e.style.setProperty("left",o/5+"px","important")),debug_mode?(a=e.querySelector(".debug-freq"))?a.innerText="Freq: "+o+"Hz":((r=document.createElement("span")).classList.add("debug-freq"),r.style.display="inline-block",r.style["font-size"]="12px",r.style.padding="4px",r.style["background-color"]="rgba(0,0,0,0.48)",r.style.color="#FFFFFF",r.style["border-radius"]="8px",r.innerText="Freq: "+o+"Hz",e.appendChild(r)):(t=e.querySelector(".debug-freq"))&&t.remove()},getFreqRange=function(t,e){switch(e){case"low":return t[t.length-1];case"mid":return t[middleValue(0,t.length-1)];case"high":return t[0]}},getFreqScale=function(t){switch(!0){case t.contains("party-time-freq-scale-10"):return 10;case t.contains("party-time-freq-scale-20"):return 20;case t.contains("party-time-freq-scale-30"):return 30;case t.contains("party-time-freq-scale-40"):return 40;case t.contains("party-time-freq-scale-50"):return 50;case t.contains("party-time-freq-scale-60"):return 60;case t.contains("party-time-freq-scale-70"):return 70;case t.contains("party-time-freq-scale-80"):return 80;case t.contains("party-time-freq-scale-90"):return 90;default:return 100}};initSetup();