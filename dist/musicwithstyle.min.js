let PARTY_ELEMENTS=[{element:"select",nodeName:"SELECT"},{element:"textarea",nodeName:"TEXTAREA"},{element:"input",nodeName:"INPUT"},{element:"svg",nodeName:"SVG"},{element:"img",nodeName:"IMG"},{element:"button",nodeName:"BUTTON"},{element:"a",nodeName:"A"},{element:"p",nodeName:"P"},{element:"span",nodeName:"SPAN"},{element:"h1",nodeName:"H1"},{element:"h2",nodeName:"H2"},{element:"h3",nodeName:"H3"},{element:"h4",nodeName:"H4"},{element:"h5",nodeName:"H5"},{element:"h6",nodeName:"H6"},{element:"caption",nodeName:"CAPTION"},{element:"td",nodeName:"TD"}],FUN_COLORS=["#ec1254","#f27c14","#f5e31d","#1ee8b6","#26a1d5","#570bb7","#d042f8","#2edbef","#3aefb6","#f10983","#d61173","#fb5cab","#52c1fa","#178bd5","#f5ed16"],COLOR_FREQ=["#1e8967","#ffd702","#f48d3f","#d02f4e"],PARTY_TEXT_CLASSES=["party-time-color","party-time-textShadow","party-time-colorVolume","party-time-fontSize"],PARTY_CONTAINER_CLASSES=["party-time-boxShadow","party-time-bkgColor","party-time-height","party-time-width","party-time-posTop","party-time-posRight","party-time-posBottom","party-time-posLeft"],PARTY_TIME_CLASSES=["party-time-color","party-time-textShadow","party-time-boxShadow","party-time-bkgColor","party-time-height","party-time-width","party-time-colorVolume","party-time-fontSize","party-time-posTop","party-time-posRight","party-time-posBottom","party-time-posLeft"],PARTY_TIME_FREQ_CLASSES=["","party-time-freq-low","party-time-freq-mid","party-time-freq-high"];function removeArrayItem(e,t){t=e.indexOf(t);-1!==t&&e.splice(t,1)}function cloneArray(e){return JSON.parse(JSON.stringify(e))}function addPartyClasses(e,t){var t=cloneArray(t),a=t[getRandomInt(0,t.length-1)];e.classList.add(a),removeArrayItem(t,a),a=t[getRandomInt(0,t.length-1)],e.classList.add(a)}function setupPartyClasses(e){switch(e.nodeName){case"SELECT":case"TEXTAREA":case"INPUT":addPartyClasses(e,PARTY_TIME_CLASSES);break;case"SVG":case"IMG":addPartyClasses(e,PARTY_CONTAINER_CLASSES);break;case"BUTTON":addPartyClasses(e,PARTY_TIME_CLASSES);break;case"A":case"P":case"SPAN":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"CAPTION":addPartyClasses(e,PARTY_TEXT_CLASSES);break;default:addPartyClasses(e,PARTY_TIME_CLASSES)}}function containsPartyTimeClasses(e){let t=!1;for(var a=0;a<PARTY_TIME_CLASSES.length;a++)e.classList.contains(PARTY_TIME_CLASSES[a])&&(t=!0);return t}function removePartyTimeClasses(e){for(var t=0;t<PARTY_TIME_CLASSES.length;t++)PARTY_TIME_CLASSES[t]&&e.classList.contains(PARTY_TIME_CLASSES[t])&&e.classList.remove(PARTY_TIME_CLASSES[t]);for(var a=0;a<PARTY_TIME_FREQ_CLASSES.length;a++)PARTY_TIME_FREQ_CLASSES[a]&&e.classList.contains(PARTY_TIME_FREQ_CLASSES[a])&&e.classList.remove(PARTY_TIME_FREQ_CLASSES[a])}function objToStyles(e,t){for(var a in t)e.style.setProperty(a,t[a],"important")}function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function middleValue(e,t){return Math.round((e+t)/2)}var _cacheIndex=[],_cacheWidth=[],_cacheHeight=[],_cache=[],_cache2=[],_cache3=[],_cache4=[];let auto_party=!1,debug_mode=!1,is_playing=!1,clear_styles=!1,audioSource=null,analyser=null,animate,audio1;var initSetup=function(){var e=document.createElement("div"),t=(e.id="party-time-container",e.classList="party-time-controls",e.style.setProperty("z-index","999999","important"),e.style.setProperty("color","white","important"),e.style.setProperty("font-size","12px","important"),e.style.setProperty("position","fixed","important"),e.style.setProperty("top","16px","important"),e.style.setProperty("right","16px","important"),e.style.setProperty("background-color","rgba(0,0,0,0.24)","important"),e.style.setProperty("padding","8px","important"),e.style.setProperty("border-radius","8px","important"),document.createElement("button")),t=(t.id="party-time-button",t.classList.add("party-time-controls"),t.innerText="ðŸŽ‰ Party Time!",t.onclick=startParty,objToStyles(t,{"margin-right":"8px",color:"white",cursor:"pointer","background-color":"purple",padding:"8px",border:"1px solid violet","border-radius":"8px","font-size":"12px"}),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","file"),t.id="party-upload",t.classList.add("party-time-controls"),t.onchange=handleAudioFile,objToStyles(t,{width:"150px","margin-right":"8px","font-size":"12px"}),e.appendChild(t),document.createElement("label")),t=(t.setAttribute("for","party-auto-party"),t.classList.add("party-time-controls"),t.innerText="Auto Party",objToStyles(t,{"font-weight":"bold",color:"white","font-size":"12px"}),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","checkbox"),t.id="party-auto-party",t.classList.add("party-time-controls"),t.onchange=handleAutoParty,e.appendChild(t),document.createElement("label")),t=(t.setAttribute("for","party-debug"),t.classList.add("party-time-controls"),t.innerText="Show Freq",objToStyles(t,{"font-weight":"bold",color:"white","font-size":"12px"}),e.appendChild(t),document.createElement("input"));t.setAttribute("type","checkbox"),t.id="party-debug",t.classList.add("party-time-controls"),t.onchange=handleDebug,e.appendChild(t),document.body.appendChild(e)},handleAudioFile=function(e){e=e.target.files,(audio1=new Audio).src=URL.createObjectURL(e[0]),audio1.loop=!0,e=new(window.AudioContext||window.webkitAudioContext);audioSource=e.createMediaElementSource(audio1),analyser=e.createAnalyser(),audioSource.connect(analyser),analyser.connect(e.destination),analyser.fftSize=128},handleAutoParty=function(e){auto_party=e.target.checked},handleDebug=function(e){debug_mode=e.target.checked},startParty=function(){var a=document.getElementById("party-time-button");if(analyser.fftSize=128,console.log(audio1.src),audio1&&audio1.pause(),audio1.src)if(is_playing)audio1.pause(),clearStyles(),is_playing=!1,clear_styles=!0,a.innerText="ðŸŽ‰ Party Time!",cancelAnimationFrame(animate);else{a.innerText="Stop The Party... ðŸ˜”",is_playing=!0,audio1.play();let e=analyser.frequencyBinCount,t=new Uint8Array(e);(animate=function(){clear_styles?clearStyles():(analyser.getByteFrequencyData(t),partyTime(e,t),requestAnimationFrame(animate))})()}},clearStyles=function(){for(var e=document.querySelectorAll('*[class*="party-time"]:not(.party-time-controls)'),t=0,a=e.length;t<a;t++)if(e[t].removeAttribute("style"),e[t].classList.contains("party-time-baby"))for(var o=e[t].querySelectorAll('*[class*="party-time"]:not(.party-time-controls)'),r=0;r<o.length;r++)removePartyTimeClasses(o[r]);for(var n=document.querySelectorAll(".debug-freq"),r=0,a=n.length;r<a;r++)n[r].remove();clear_styles=!1,_cacheIndex=[],_cacheWidth=[],_cacheHeight=[],_cache=[],_cache2=[],_cache3=[],_cache4=[]},applyStyles=function(e){for(var t=0,a=e.length;t<a;t++)e[t].style={}},partyTime=function(t,e){for(var a=[],o=0;o<t;o++)0!==e[o]&&a.push(e[o]);auto_party&&(document.body.classList.contains("party-time-bkgColor")||document.body.classList.add("party-time-bkgColor"),document.body.classList.contains("party-time-baby")||document.body.classList.add("party-time-baby"));var r=document.querySelectorAll('*[class*="party-time"]:not(.party-time-controls)');for(let e=0;e<r.length;e++)if(r[e])if(r[e].classList.contains("party-time-baby")){var n,i=r[e].querySelectorAll("select:not(.debug-freq),textarea:not(.debug-freq),input:not(.debug-freq),svg:not(.debug-freq),img:not(.debug-freq),button:not(.debug-freq),a:not(.debug-freq),p:not(.debug-freq),span:not(.debug-freq),h1:not(.debug-freq),h2:not(.debug-freq),h3:not(.debug-freq),h4:not(.debug-freq),h5:not(.debug-freq),h6:not(.debug-freq),caption:not(.debug-freq),td:not(.debug-freq)");for(let e=0;e<i.length;e++)i[e]&&(!containsPartyTimeClasses(i[e])&&(setupPartyClasses(i[e]),n=PARTY_TIME_FREQ_CLASSES[getRandomInt(0,PARTY_TIME_FREQ_CLASSES.length-1)])&&i[e].classList.add(n),vfx(e,i[e],t,a))}else vfx(e,r[e],t,a)},vfx=function(e,t,a,o){_cacheIndex[e]||(_cacheIndex[e]=getRandomInt(0,a-1));let r=o[_cacheIndex[e]]||0!==o[_cacheIndex[e]]?o[_cacheIndex[e]]:o[getRandomInt(0,a-1)];t.classList.contains("party-time-freq-low")&&(r=getFreqRange(o,"low")),t.classList.contains("party-time-freq-mid")&&(r=getFreqRange(o,"mid")),t.classList.contains("party-time-freq-high")&&(r=getFreqRange(o,"high")),t.classList.contains("party-time-color")&&(a=Math.floor(r/100),_cache[e]!==a)&&(_cache[e]=a,t.style.setProperty("color",FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],"important")),t.classList.contains("party-time-textShadow")&&(o=Math.floor(r/100),_cache3[e]!==o)&&(_cache3[e]=o,a=FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],t.style.setProperty("color","#FFFFFF","important"),t.style.setProperty("text-shadow","0 0 "+r/10+"px #fff, 0 0 "+r/9+"px #fff, 0 0 "+r/8+"px "+a+", 0 0 "+r/7+"px "+a+", 0 0 "+r/6+"px "+a+", 0 0 "+r/5+"px "+a+", 0 0 "+r/4+"px "+a,"important")),t.classList.contains("party-time-boxShadow")&&(o=Math.floor(r/100),_cache4[e]!==o)&&(_cache4[e]=o,a=FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],t.style.setProperty("box-shadow","0 0 10px #fff, 0 0 20px #fff, 0 0 30px "+a+", 0 0 40px "+a+", 0 0 50px "+a+", 0 0 60px "+a+", 0 0 70px "+a,"important")),t.classList.contains("party-time-bkgColor")&&(o=Math.floor(r/100),_cache2[e]!==o)&&(_cache2[e]=o,t.style.setProperty("background-color",FUN_COLORS[getRandomInt(0,FUN_COLORS.length-1)],"important")),t.classList.contains("party-time-colorVolume")&&t.style.setProperty("color",COLOR_FREQ[Math.floor(r/100)],"important"),t.classList.contains("party-time-fontSize")&&(a=r/5,t.style.setProperty("font-size",(a<=0?10:a)+"px","important")),t.classList.contains("party-time-width")&&(_cacheWidth[e]||(_cacheWidth[e]=t.offsetWidth),t.style.setProperty("width",_cacheWidth[e]+r/2+"px","important")),t.classList.contains("party-time-height")&&(_cacheHeight[e]||(_cacheHeight[e]=t.offsetHeight),t.style.setProperty("height",_cacheHeight[e]+r/2+"px","important")),t.classList.contains("party-time-posTop")&&(t.style.setProperty("position","relative","important"),t.style.setProperty("top",r/5+"px","important")),t.classList.contains("party-time-posRight")&&(t.style.setProperty("position","relative","important"),t.style.setProperty("right",r/5+"px","important")),t.classList.contains("party-time-posBottom")&&(t.style.setProperty("position","relative","important"),t.style.setProperty("bottom",r/5+"px","important")),t.classList.contains("party-time-posLeft")&&(t.style.setProperty("position","relative","important"),t.style.setProperty("left",r/5+"px","important")),debug_mode?(o=t.querySelector(".debug-freq"))?o.innerText="Freq: "+r+"Hz":((a=document.createElement("span")).classList.add("debug-freq"),a.style.display="inline-block",a.style["font-size"]="12px",a.style.padding="4px",a.style["background-color"]="rgba(0,0,0,0.48)",a.style.color="#FFFFFF",a.style["border-radius"]="8px",a.innerText="Freq: "+r+"Hz",t.appendChild(a)):(e=t.querySelector(".debug-freq"))&&e.remove()},getFreqRange=function(e,t){switch(t){case"low":return e[e.length-1];case"mid":return e[middleValue(0,e.length-1)];case"high":return e[0]}};initSetup();